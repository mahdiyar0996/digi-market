{% extends 'index.html' %}
{% block title %}
    {{ product.name }}
{% endblock %}
{% load static %}
{% block css %}
    <style>
    @media (max-width: 768px) {
  #product-image {
    width: 75%;
  }
}
    </style>
{% endblock %}
{% block content %}
<div class="row flex-md-row mx-2 justify-content-center justify-content-md-start">
    <ul class="text-decoration-none">
    <a class="text-muted text-decoration-none" href="{% url 'subcategory' product.category.category.name %}">{{ product.category.category.name }}</a> /
        <a class="text-muted text-decoration-none" href="{% url 'product-list' product.category.name %}">{{ product.category.name }}</a> /
        <a class="text-muted text-decoration-none">{{ product.tag }}</a>
    </ul>
    <div class="col-3 justify-content-center justify-content-md-start" id="product-image" style="height: 500px">
        <div id="carouselExampleAutoplaying" style="height: 100%" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner h-100">
              {% for image in product_images %}
            <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %} h-100">
              <img src="{{image.images.url}}" class="d-block img-fluid h-100"  alt="..." >
            </div>
              {% endfor %}
            </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
                <span class="visually-hidden">Previous</span>
            </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                <span class="carousel-control-next-icon" ></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <div class="col-8" id="product-details">
        <h5 class="">{{ product.name }}</h5>
        <hr>
        <ul>
            <li class="d-inline-block">
                <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="mb-1 bi bi-star-fill text-warning" viewBox="0 0 16 16">
                  <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                </svg>
                {{ average }}
            </li>
            <li class="d-inline-block ms-3 text-info">{{ comment_counts }}دیدگاه </li>
        </ul>
        <div class="ms-3">
            <h5 class="mb-5" style="font-family: KacstPen">
                ویژه گی ها
            </h5>
            {% for key,value in product_details %}
                <div class="d-flex flex-row">
            <p class="me-4">{{ key }}:</p>
                <p>{{ value }}</p>
                </div>
            {% endfor %}
        </div>
    </div>
    {% if product.description %}
    <hr>
    <div class="col-12 my-2 px-4">
        <h4 class="d-flex col-4 col-md-4 col-lg-3 justify-content-evenly mb-3">درباره کالا</h4>
        {{ product.description }}
    </div>
    <hr>
    {% endif %}
</div>
    <ul class="list-unstyled mx-5 d-block">
        <li>
            <a class="btn btn-primary" data-bs-toggle="collapse" href="#comments" role="button" aria-expanded="false" aria-controls="collapseExample">
            دیدگاه{{ comment_counts }}
            </a>
        </li>
    </ul>
    <hr>
<div class="row px-4 collapse" id="comments">
{% for comment in product_comments %}
    <div class="card pt-3 mb-5 ms-3" style="width: 800px">
        <p class="card-title d-flex justify-content-between" style="width: 300px">
            {{ comment.user.username }}
            <span>{{ comment.created_at }}</span>
        </p>
        <p class="d-flex justify-content-start align-items-center">
        <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill text-warning" viewBox="0 0 16 16">
          <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
        </svg>
        {{ comment.rating }}
        </p>
        <div class="card-body">
            {{ comment.comment }}
        </div>
    </div>
{% endfor %}
</div>
    <div class="row">
        <form action="" method="POST" class="ms-5 mb-5 col-8 col-sm-6 flex-column">
        {% csrf_token %}
            <h4>ثبت دیدگاه</h4>
            {% for field in form %}
                <label for="{{ field.label }}" class="d-block mt-3 mb-5">
                {{ field.label }}
                {% if field.name != 'rating' %}
                    <textarea class="text-start form-text" type="{{ field.widget_type }}" placeholder="{{ field.help_text }}" id="{{ field.name }}" style="width: 100%;min-height: 100px;max-height: 140px" required name="{{ field.name }}"></textarea>
                    {% else %}
                    <select class="form-select" style="width: 80px" name="{{ field.name }}" id="{{ field.name }}" required >
                        {% for option in field %}
                            {{ option }}
                        {% endfor %}
                    </select>
                {% endif %}
                </label>
            {% endfor %}
            <div class="d-flex w-100 justify-content-center">
            <button class="btn btn-primary"  type="submit">ارسال</button>
            </div>
        {% if messages %}
            {% for msg in messages %}
                <p class="text-{{ msg.tags }} text-center mt-3">{{ msg }}</p>
            {% endfor %}
        {% endif %}
        </form>
    </div>
    <hr>
{% endblock %}
