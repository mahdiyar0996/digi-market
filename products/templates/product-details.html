{% extends 'index.html' %}
{% block title %}
    {{ product.name }}
{% endblock %}
{% load static %}
{% block css %}
    <style>
        @media (max-width: 768px) {
        #product-image {
        width: 75%;
                        }
                        }
    </style>
{% endblock %}
{% block content %}
<div class="row flex-md-row mx-2 justify-content-center justify-content-md-start">
    <ul class="text-decoration-none">
    <a class="text-muted text-decoration-none" href="{% url 'category-list' product.category.category.category.name %}">{{ product.category.category.name }}</a> /
        <a class="text-muted text-decoration-none" href="{% url 'subcategory-list' product.category.category.name %}">{{ product.category.category.name }}</a> /
        <a class="text-muted text-decoration-none">{{ product.category.name }}</a>
    </ul>
    <div class="col-3 justify-content-center justify-content-md-start" id="product-image" style="height: 500px">
        <div id="carouselExampleAutoplaying" style="height: 100%" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner h-100">
              {% for image in product_images %}
                <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %} h-100">
                  <img src="{{image.images}}" class="d-block img-fluid h-100"  alt="..." >
                </div>
              {% endfor %}
            </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
                <span class="visually-hidden">Previous</span>
            </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <div class="col-8" id="product-details">
        <h5 class="">{{ product.name }}</h5>
        <hr>
        <ul>
            <li class="d-inline-block">
                <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="mb-1 bi bi-star-fill text-warning" viewBox="0 0 16 16">
                  <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                </svg>
                {{ average }}
            </li>
            <li class="d-inline-block ms-3 text-info">{{ comment_counts }}دیدگاه </li>
        </ul>
        <div class="ms-3 row flex-row">
            <div class="col-6">
                <h5 class="mb-5" style="font-family: KacstPen">
                    ویژه گی ها
                </h5>
                {% for key,value in product_details %}
                    <div class="d-flex flex-row">
                <p class="me-4">{{ key }}:</p>
                    <p>{{ value }}</p>
                    </div>
                {% endfor %}
            </div>
            <form class="col-6 flex-column justify-content-start card d-none d-md-flex" method="POST" action="">
            {% csrf_token %}
                <div class="my-2 d-block">
                    <img src="/media/site_images/logo%20image.jpg" width="16" height="16"></img>
                    دیجی مارکت
                </div>
                <div class="my-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-check" viewBox="0 0 16 16">
                      <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                      <path d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                    </svg>
                    گارانتی {{ product.warranty }}
                </div>
                {% if product.stock > 10 %}
                    <div class="my-2 text-success">موجود در انبار</div>
                {% elif product.stock < 10%}
                    <div class="text-danger my-2">تنها{{ product.stock }}کالا باقی مانده</div>
                {% endif %}
                {% if not product.discount > 0 %}
                <div class="text-end mb-4 mt-2">{{ product.split_price }}تومان</div>
                {% else %}
                    <div class="d-flex justify-content-end">
                        <div class="me-5">
                    <span class="text-end mb-4 mt-2 text-decoration-line-through  text-muted">
                        {{ product.get_discount }}تومان
                    </span>
                    <span class="text-body bg-danger strong fw-light" style="height: 24px;width: 32px">{{ product.discount }}%</span>
                        </div>
                    </div>
                    <div class="text-end mb-4 mt-2 ">{{ product.split_price }}تومان</div>
                {% endif %}
                {% if not is_in_basket %}
                <button class="btn btn-danger text-center" type="submit" name="add-to-basket" value="{{ product.name }}">افزودن به سبد خرید</button>
                {% else %}
                    <div class="bg-danger text-center">به سبد خرید شما اضافه شد</div>
                    <div class="card my-2 p-2 d-inline" style="width: 150px">
                    <button class="btn align-items-center" type="submit" style="width: 32px; height: 32px" name="add-more" value="{{ product.name }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="text-danger bi bi-plus-lg fw-bolder mb-3" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                        </svg>
                    </button>
                        <div class="d-inline-flex justify-content-center align-items-center" style="width: 32px; height: 32px">
                        {{ is_in_basket.count }}
                        </div>
                    <button class="btn"  type="submit" style="width: 32px; height: 32px" name="delete-from-basket" value="{{ product.name }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="text-danger bi bi-trash mb-3" viewBox="0 0 16 16">
                          <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                          <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                        </svg>
                    </button>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>
    <form class="col-12 flex-column justify-content-start card d-md-none" action="" method="POST">
    {% csrf_token %}
        <div class="my-2">
            <img src="/media/site_images/logo%20image.jpg" width="16" height="16">
            دیجی مارکت
        </div>
        <div class="my-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-check" viewBox="0 0 16 16">
              <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
              <path d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
            </svg>
            گارانتی {{ product.warranty }}
        </div>
        {% if product.stock > 10 %}
            <div class="my-2 text-success">موجود در انبار</div>
        {% elif product.stock < 10%}
            <div class="text-danger my-2">تنها{{ product.stock }}کالا باقی مانده</div>
        {% endif %}
            {% if not is_in_basket %}
            <button class="btn btn-danger text-center" type="submit" name="add-to-basket" value="{{ product.name }}">افزودن به سبد خرید</button>
            {% else %}
            <div class="bg-danger text-center">به سبد خرید شما اضافه شد</div>
            <div class="card my-2 p-2 d-inline" style="width: 150px">
            <button class="btn align-items-center" type="submit" style="width: 32px; height: 32px" name="add-more" value="{{ product.name }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="text-danger bi bi-plus-lg fw-bolder mb-3" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
            </button>
                <div class="d-inline-flex justify-content-center align-items-center" style="width: 32px; height: 32px">
                {{ is_in_basket.count }}
                </div>
            <button class="btn"  type="submit" style="width: 32px; height: 32px" name="delete-from-basket" value="{{ product.name }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="text-danger bi bi-trash mb-3" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                  <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                </svg>
            </button>
            {% endif %}
        </div>
    </form>
    {% if product.description %}
    <hr>
    <div class="col-12 my-2 px-4">
        <h4 class="d-flex col-4 col-md-4 col-lg-3 justify-content-evenly mb-3">درباره کالا</h4>
        {{ product.description }}
    </div>
    {% endif %}
    <hr>
</div>
    <ul class="list-unstyled mx-5 d-block">
        <li>
            <a class="btn btn-primary" data-bs-toggle="collapse" href="#comments" role="button" aria-expanded="false" aria-controls="collapseExample">
            دیدگاه{{ comment_counts }}
            </a>
        </li>
    </ul>
    <hr>
<div class="row px-4 collapse" id="comments">
{% for comment in product_comments %}
    {% if comment.is_active %}
    <div class="card pt-3 mb-5 ms-3" style="width: 800px">
        <p class="card-title d-flex justify-content-between" style="width: 300px">
            {{ comment.user.username }}
            <span>{{ comment.created_at }}</span>
        </p>
        <p class="d-flex justify-content-start align-items-center">
        <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill text-warning" viewBox="0 0 16 16">
          <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
        </svg>
        {{ comment.rating }}
        </p>
        <div class="card-body">
            {{ comment.comment }}
        </div>
    </div >
{% endif %}
{% endfor %}
</div>
    <div class="row">
        <form action="" method="POST" class="ms-5 mb-5 col-8 col-sm-6 flex-column">
        {% csrf_token %}
            <h4>ثبت دیدگاه</h4>
            {% for field in form %}
                <label for="{{ field.label }}" class="d-block mt-3 mb-5">
                {{ field.label }}
                {% if field.name != 'rating' %}
                    <textarea class="text-start form-text" type="{{ field.widget_type }}" placeholder="{{ field.help_text }}" id="{{ field.name }}" style="width: 100%;min-height: 100px;max-height: 140px" required name="{{ field.name }}"></textarea>
                {% else %}
                    <select class="form-select" style="width: 80px" name="{{ field.name }}" id="{{ field.name }}" required >
                        {% for option in field %}
                            {{ option }}
                        {% endfor %}
                    </select>
                {% endif %}
                </label>
            {% endfor %}
            <div class="d-flex w-100 justify-content-center">
            <button class="btn btn-primary"  type="submit">ارسال</button>
            </div>
        {% if messages %}
            {% for msg in messages %}
                <p class="text-{{ msg.tags }} text-center mt-3">{{ msg }}</p>
            {% endfor %}
        {% endif %}
        </form>
    </div>
    <hr>
{% endblock %}
