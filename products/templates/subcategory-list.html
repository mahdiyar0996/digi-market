{% extends 'index.html' %}
{% block title %}
    لیست محصولات
{% endblock %}
{% block css %}
{% endblock %}
{% block content %}
<div class="row mt-1 jus">
    <div class="card col-3 flex-column position-sticky mt-0 " style="height: max-content">
        <h4 class="card-title text-center mt-2">فیلتر ها</h4>
        <form onsubmit="validate()" class="ms-2" action="" method="GET">
            <a style="height: 57px" class="text-start d-block fs-5 pt-3 text-decoration-none border border-start-0 border-end-0 border-bottom-0" data-bs-toggle="collapse" data-bs-target="#categories" href="#categories" role="button" aria-expanded="false" aria-controls="collapseExample">
            دسته بندی ها
            </a>
            <div class="ms-2 my-1 collapse" id="categories">
                {% for category in sub_sub_categories %}
                    <div class="card-body">
                        <input type="checkbox" name="category" value="{{ category }}">
                        {{ category }}
                    </div>
                {% endfor %}
            </div>
            <a style="height: 57px;" class="text-start d-block pt-3 mt-1 fs-5 text-decoration-none border border-start-0  border-end-0 border-bottom-0" data-bs-toggle="collapse" data-bs-target="#price" href="#price" role="button" aria-expanded="false" aria-controls="collapseExample">
            محدوده قیمت
            </a>
            <div class="ms-2 my-1 collapse" id="price">
                    <div class="card-body">
                        <div class="d-flex flex-column flex-nowrap align-items-center">
                            <span class="w-100">از
                            <input id="min_price" type="text" class="form-control form-text border border-top-0 border-end-0 border-start-0 ms-2" placeholder="0" name="min_price" min="0" max="{{ max_price }}" oninput="this.nextElementSibling.value = this.value">
                            </span>
                            <div class="w-100 mt-2">
                            <span class="">
                                 تا
                                <input id="max_price" dir="rtl" type="range" class="ms-2 form-control form-range" name="max_price" value="0" min="0" max="{{ max_price }}" oninput="this.nextElementSibling.value = this.value">
                                <output>0</output>

                            </span>
                            </div>
                                <script>
                                    function validate() {
                                         var min_price = document.getElementById('min_price').value;
                                         var max_price = document.getElementById('max_price').value;
                                         var var1 = 0.001;
                                         if (min_price < var1) {
                                          document.getElementById("min_price").disabled = true;
                                         }
                                         if (max_price < var1){
                                             document.getElementById("max_price").disabled = true;
                                         }
                                         return true;
                                        }
                                </script>
                        </div>
                    </div>
            </div>
            <div class="d-flex mt-2 align-self-start border border-start-0 border-end-0 pt-2" style="height: 57px;">
                <div class="form-check form-check-inline w-100 h-100">
                    <input name="is_active" id="is_active" type="checkbox" class="form-check-input d-inline mt-2" style="height: 24px; width: 24px">
                    <label role="button" for="is_active" class="form-check-label ms-3 mt-2 w-100 h-100">فقط کالاهای موجود</label>
                </div>
            </div>
            <br>
            <div class="d-flex justify-content-center align-items-center">
            <button type="submit" class="btn btn-primary text-center mb-3">اعمال فیلتر</button>
            </div>
        </form>
    </div>
    <div class="col-9 d-flex flex-row mt-0" style="height: 100vh; justify-self: end">
        <div class="row justify-content-lg-start" style="width: 100%">
        {% for field in products %}
         <a href="{% url 'product-details' field.category__name field.id %}" class="col-6 col-md-4 d-flex col-sm-2 flex-column justify-content-center align-items-center p-3 text-center text-decoration-none border" style="max-width: 337px;min-width: 250px; height: 400px" id="product-box">
            <img src="{{ field.avatar }}" alt="" width="220" height="200">
            <p class="d-block" style="height: 80px">{{ field.name }}</p>
            <div class="d-flex flex-row flex-nowrap justify-content-between w-100">
                <p class="d-block {% if field.stock < 10 %}text-danger{% endif %}" style="justify-self: start">تعداد در انبار{{ field.stock }}</p>
                <p class="d-block" style="justify-self: end">{% if field.average > 0 %}{{ field.average|floatformat:1 }}{% else %}0{% endif %}
                    <svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill text-warning mb-1" viewBox="0 0 16 16">
                      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                    </svg>
                </p>
            </div>
            <div class="d-flex flex-row w-100 justify-content-between">
            {% if field.discount %}
                <div class="bg-danger" style="justify-self: start">{{ field.discount }}%</div>
            {% endif %}
                <div class="invisible"></div>
                <div class="" style="justify-self: end"> {{ field.price }}تومان </div>
            </div>
            {% if field.discount %}
            <div class="d-flex w-100 justify-content-end">
            <span class="text-decoration-line-through text-muted">{{ field.discounted_price }}</span>
            </div>
         {% endif %}
        </a>
        {% endfor %}
            {% if paginator.num_pages > 1 %}
            <form aria-label="..." class="d-flex justify-content-center align-items-center col-12 mt-5" style="height: 38px">
              <ul class="pagination">
              {% if products.has_next %}
                <li class="page-item">
                    <button class="page-link" type="submit" name="page" value="{{ paginator.num_pages }}"><< </button>
                </li>
                <li class="page-item">
                  <button class="page-link" type="submit" name="page" value="{{ products.next_page_number }}"><</button>
                </li>
                <li class="page-item"><button type="submit" name="page" value="{{ products.number|add:1 }}" class="page-link" href="#">{{ products.number|add:1 }}</button></li>
              {% endif %}
                <li class="page-item active" aria-current="page">
                  <a class="page-link" href="#">{{ products.number }}</a>
                </li>
              {% if products.has_previous %}
                <li class="page-item"><button class="page-link" type="submit" name="page" value="{{ products.number|add:-1 }}" href="#">{{ products.number|add:-1 }}</button></li>
                <li class="page-item">
                    <button class="page-link" type="submit" name="page" value="{{ products.previous_page_number }}">> </button>
                </li>
                <li class="page-item">
                    <button class="page-link" type="submit" name="page" value="1">>> </button>
                </li>
              {% endif %}
              </ul>
            </form>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}